jQuery(function(t){function e(e,a,n){var r={tour_id:n,year:a,action:"st_get_disable_date_tour"};t.post(st_params.ajax_url,r,function(a){""!=a&&a,booking_period=e.data("booking-period"),e.datepicker("setStartDate","+"+booking_period+"d"),t(".overlay-form").fadeOut(500)},"json")}function a(e){if(e.fullCalendar){var a=e.fullCalendar.getDate(),n=moment(a).format("M");t(".calendar_change_month").val(n)}}function n(e,a,n,r){var o=t(".package-info-wrapper"),d=t(".overlay-form",o);d.hide(),t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_starttime_tour_frontend",tour_id:e,check_in:a,check_out:n},beforeSend:function(){d.show()},success:function(e){if(null!=e.data&&e.data.length>0){t("#starttime_tour option").remove(),t("#starttime_box").show();var a="";for(i=0;i<e.data.length;i++){var n="";"-1"==e.check[i]?e.data[i]==r?a+='<option value="'+e.data[i]+'" selected '+n+">"+e.data[i]+"</option>":a+='<option value="'+e.data[i]+'" '+n+">"+e.data[i]+"</option>":"0"==e.check[i]?e.data[i]==r?a+='<option value="'+e.data[i]+'" selected '+n+">"+e.data[i]+" ( "+st_params.no_vacancy+" )</option>":a+='<option value="'+e.data[i]+'" '+n+">"+e.data[i]+" ( "+st_params.no_vacancy+" )</option>":e.data[i]==r?"1"==e.check[i]?a+='<option value="'+e.data[i]+'" selected '+n+">"+e.data[i]+" ( "+st_params.a_vacancy+" )</option>":e.check[i]<0?a+='<option value="'+e.data[i]+'" selected '+n+">"+e.data[i]+" ( "+st_params.no_vacancy+" )</option>":a+='<option value="'+e.data[i]+'" selected '+n+">"+e.data[i]+" ( "+e.check[i]+" "+st_params.more_vacancy+" )</option>":"1"==e.check[i]?a+='<option value="'+e.data[i]+'" '+n+">"+e.data[i]+" ( "+st_params.a_vacancy+" )</option>":e.check[i]<0?a+='<option value="'+e.data[i]+'" '+n+">"+e.data[i]+" ( "+st_params.no_vacancy+" )</option>":a+='<option value="'+e.data[i]+'" '+n+">"+e.data[i]+" ( "+e.check[i]+" "+st_params.more_vacancy+" )</option>"}t("#starttime_tour option").remove(),t("#starttime_tour").append(a),d.hide()}else t("#starttime_box").hide(),d.hide();!1}}),!0}if(!(t(".st_single_tour").length<1)){t.fn.tooltip&&t('[data-toggle="tooltip"]').tooltip();if(t("input.tour_book_date").length>0?(t("input.tour_book_date").each(function(a,n){t(this).datepicker({language:st_params.locale,format:t(this).data("date-format"),todayHighlight:!0,autoclose:!0,startDate:"today",weekStart:1}),date_start=t(this).datepicker("getDate"),t(this).datepicker("addNewClass","booked");var r=t(this);null==date_start&&(date_start=new Date),year_start=date_start.getFullYear(),tour_id=t(this).data("tour-id"),e(r,year_start,tour_id)}),t("input.tour_book_date").on("changeYear",function(a){var n=t(this);year=new Date(a.date).getFullYear(),tour_id=t(this).data("tour-id"),e(n,year,tour_id)})):t(".package-info-wrapper .overlay-form").fadeOut(500),t(document).ajaxStop(function(){t(".overlay-form").fadeOut(500)}),t("#check_in").length){var r=t("#check_in").val(),o=t("#check_out").val();r!=o?t("input#check_out").parent().show():t("input#check_out").parent().hide();var d=t('input[name="type_tour"]').val();if("daily_tour"==d){o=t("#check_in").val();t("input#check_out").parent().hide()}if(""!=r){var l=t("#starttime_hidden_load_form").data("tourid"),c=t("#starttime_hidden_load_form").data("starttime");""!=c&&void 0!==c&&n(l,r,o,c)}}var s=function(e){var a=this;this.container=e,this.calendar=null,this.form_container=null,this.fullCalendar=null,this.timeOut,this.fullCalendarOptions={initialView:"dayGridMonth",firstDay:1,locale:st_params.locale_fullcalendar,timeZone:st_timezone.timezone_string,customButtons:{reloadButton:{text:st_params.text_refresh,click:function(){a.fullCalendar&&a.fullCalendar.refetchEvents()}}},headerToolbar:{start:"prev",center:"title",end:"next"},displayEventTime:!0,selectable:!0,select:function({start:e,end:n,startStr:r,endStr:o,allDay:i,jsEvent:d,view:l,resource:c}){if(moment(e).isBefore(moment(),"day")||moment(n).isBefore(moment(),"day"))a.fullCalendar.unselect();else{var s=moment(e).format("Z");s=s.split(":"),s=parseInt(s[0])+":00";var u=moment(e).utcOffset(s).format(String(st_params.date_format_calendar||"MM/DD/YYYY").toUpperCase()),p=moment(n).utcOffset(s).subtract(1,"day").format(String(st_params.date_format_calendar||"MM/DD/YYYY").toUpperCase());t("input#check_in").val(u).parent().show(),t("input#check_out").val(p).parent().show()}},events:function({start:e,end:n,startStr:r,endStr:o,timeZone:i},d,l){t.ajax({url:st_params.ajax_url,dataType:"json",type:"post",data:{action:"st_get_availability_tour_frontend",tour_id:t(a.container).data("post-id"),start:moment(e).unix(),end:moment(n).unix()},success:function(t){if("object"==typeof t){let e=t;"object"==typeof t.events&&(e=t.events),d(e)}else console.log("Can not get data")},error:function(t){alert("Can not get the availability slot. Lost connect with your sever")}})},eventContent:function(e){var n=jQuery(a.calendar).data("hide_adult"),r=jQuery(a.calendar).data("hide_children"),o=jQuery(a.calendar).data("hide_infant"),i=jQuery(a.calendar).data("price-type");t(".calendar-wrapper").data("current-date");let d=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div");d.classList.add("fc-content"),l.classList.add("price"),c.classList.add("starttime");var s=moment(e.event.start).date(),u="none";e.event.end&&(s+=" - "+moment(e.event.end).date(),u="group");var p=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate(),f=moment(a.fullCalendar.getDate()).format("MM"),_=moment(e.event.start).format("MM"),m="";if(_!=f&&(m="next_month"),"available"==e.event.extendedProps.status){var v="";i&&"person"==i?("on"!=n&&e.event.extendedProps.adult_price&&(v+=st_checkout_text.adult_price+": "+e.event.extendedProps.adult_price+" <br/>"),"on"!=r&&e.event.extendedProps.child_price&&(v+=st_checkout_text.child_price+": "+e.event.extendedProps.child_price+" <br/>"),"on"!=o&&e.event.extendedProps.infant_price&&(v+=st_checkout_text.infant_price+": "+e.event.extendedProps.infant_price)):e.event.extendedProps.base_price&&(v+=st_checkout_text.price+": "+e.event.extendedProps.base_price);var h="n";e.event.extendedProps.starttime&&(v+='<br /><i class="fa fa-clock-o" aria-hidden="true"></i> '+e.event.extendedProps.starttime,h="data-starttime='y'"),s="<button "+h+" data-placement='top' title  = '"+v+"' data-toggle='tooltip' class='"+u+" "+m+" btn btn-available'>"+s}else s="<button disabled data-placement='top' title  = 'Disabled' data-toggle='tooltip' class='"+u+" btn btn-disabled'>"+s;p===e.event.start&&(s+="<span class='triangle'></span>"),s+="</button>",jQuery(e.el).addClass("event-"+e.event.id),jQuery(e.el).addClass("event-number-"+moment(e.event.start).unix()),d.innerHTML=s;let y=[d];return{domNodes:y}},eventDidMount:function(e){t('[data-toggle="tooltip"]').tooltip({html:!0})},viewDidMount:function(e){if(e.el){let n=e.el;a.timeOut&&clearTimeout(a.timeOut),a.timeOut=setTimeout(function(){let e=t(n).closest(".fc-view-harness.fc-view-harness-active");e&&0==e.outerHeight()&&e.css({minHeight:"250px"})},400)}},eventClick:function({event:e,el:r,jsEvent:o,view:i}){var d="",l="";if(t(r).find("button").hasClass("btn-available")){t(".fc-event").removeClass("st-active"),t(r).addClass("st-active");var c=t(r).find("button").data("starttime");date=moment(e.start),t("input#check_in").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().show(),d=date.format(st_params.date_format_calendar.toUpperCase()),e.end?(date=new Date(e.end),date=moment(date),l=date.format(st_params.date_format_calendar.toUpperCase()),t("input#check_out").val(date.format(st_params.date_format_calendar.toUpperCase())).parent().show()):(date=moment(e.start).format(st_params.date_format_calendar.toUpperCase()),t("input#check_out").val(date).parent().hide()),t("input#adult_price").val(e.adult_price),t("input#child_price").val(e.child_price),t("input#infant_price").val(e.infant_price),"y"==c?n(a.container.data("post-id"),d,l,""):(t(".st_tours_starttime option").remove(),t(".tour-starttime").hide())}},loading:function(e){e?t(".overlay",a.container).addClass("open"):t(".overlay",a.container).removeClass("open")}},this.init=function(){a.container=jQuery(e),a.calendar=e.querySelector(".calendar-content"),a.form_container=t(".calendar-form",a.container),a.initCalendar()},this.initCalendar=function(){jQuery(a.calendar).data("hide_adult"),jQuery(a.calendar).data("hide_children"),jQuery(a.calendar).data("hide_infant"),jQuery(a.calendar).data("price-type"),t(".calendar-wrapper").data("current-date");"undefined"!=typeof FullCalendar&&(a.fullCalendar=new FullCalendar.Calendar(a.calendar,a.fullCalendarOptions),a.fullCalendar.render())}};t("#select-a-tour").length<=0&&t(".calendar-wrapper").each(function(e,n){var r=t(this),o=new s(n);o.init(),t("body").on("calendar.change_month",function(t,e){if(o.fullCalendar){var a=o.fullCalendar.getDate(),n=a.format("M");a=a.add(e-n,"M"),o.fullCalendar.gotoDate(a.format("YYYY-MM-DD"))}});var i=!1;t("body").on("click",".st-tour-tabs-content .request",function(){if(!i){var t=r.data("current-date");""!=t&&setTimeout(function(){if(o.fullCalendar){o.fullCalendar.refetchEvents(),o.fullCalendar.gotoDate(t);let e=r.find(".fc-view-harness.fc-view-harness-active");e&&0==e.innerHeight()&&e.css({height:"380px"})}i=!0},1e3)}}),a(o),t(".fc-next-button, .fc-prev-button").on("click",function(){a(o)})}),t("a.request").length>0&&"#request"==window.location.hash&&t("a.request").trigger("click"),t(function(){if(t("#select-a-tour").length&&t("#select-a-tour").length&&"undefined"!=typeof tippy){let e=document.querySelector("#select-a-tour");document.querySelector("#list_tour_item");tippy(e,{delay:100,allowHTML:!0,trigger:"manual",placement:"auto-end",hideOnClick:!1,interactive:!0,appendTo:document.body,content:t("#list_tour_item").html(),onClickOutside(t,e){e.target==t.reference&&e.target==t.popper||t.hide()},onShow(e){e&&e.popper&&t(".calendar-wrapper",e.popper).each(function(e,n){var r=t(this),o=new s(n);o.init(),t("body").on("calendar.change_month",function(t,e){if(o.fullCalendar){var a=o.fullCalendar.getDate(),n=a.format("M");a=a.add(e-n,"M"),o.fullCalendar.gotoDate(a.format("YYYY-MM-DD"))}});var i=!1;t("body").on("click",".st-tour-tabs-content .request",function(){if(!i){var t=r.data("current-date");""!=t&&setTimeout(function(){o.fullCalendar&&o.fullCalendar.gotoDate(t),i=!0},1e3)}}),a(o),t(".fc-next-button, .fc-prev-button").on("click",function(){a(o)})})}}),e.addEventListener("click",function(){e._tippy&&e._tippy.show()})}})}});